# TCM Security
##  Practical Ethical Hacking
<hr />

### Network Refresher
#### IP Adresses
  There are 2 types of notation
  - **Ipv4** is **decimal** notation
  - **Ipv6** is in **hexadecimal** notation

IPv4 is the **most commonly used format**, we used for almost everything
 The **IPv4** has **32 bits**, divided In 4 periods (192.168.1.12), that means that 192 = 8 bits 
 
We **ran out of IPv4 space** that the reason why a house has only one public IPv4 adress
**2^32 bits** = 4 294 967 296
But fot IPv6 we have a lot of space

An IPv6 has **128 bits** that means that we can can have **2^128 bits** and it's a **huge number** lmao
We came with the idea of IPv6 but none use it.

How are we using **IPv4** even if we **ran of space** ?
We are using something called NAT = **Network Adress Translation,** you might have multiple devices in your home, all these adresses are using NAT, threy **don't all have a public IP adress** that why we are using NAT, with NAT we are **giving private IP adresses** , and all of these devices are using **one public ip adress** and this is how we solved the issue without using IPv6

Ip adresses are **Layer 3 protocols** it's the **Router Layer**, when we route traffic **we route form IP adresses**.

#### Mac Adresses
Mac Adresses are **Layer 2** it's related to **Switching**.
it's a **physical adress**, switches are using Mac adresses to communicate, When we download a **Nec** (Network Interface) **a mac adress is assigned.**
Mac adresses have **identifiers** they have **6 pairs of 2**
00:0c:29:0a:42:05
The **first 3 pairs are identifer** for example :
- 00:0c:29 = Vmware, Inc.
and we can identify the target with the Mac Adress

#### TCP, UDP, Three Way Handshake
Now we are talking about the **Transport Layer it's the Layer 4**.
##### TCP vs UDP
- TCP is know as **Transmission Control Protocol**  and it's a **connection oriented protocol**
- UDP is know as **User Datagram Protocol** and it's a **connection less protocol**
So when we have these two protocols one is best suited when it comes to **high reliability, That's TCP** when we want to make a connection we used TCP like loading a webpage that's HTTP and it's utilize TCP 
When you think about **UDP it's for something like a streaming service** that's connection less or **DNS** connections or **Voice over IP** is connection less.

When We are going to be **scanning** the most commonly used protocol will be **TCP**

##### The Three Way Handshake
**TCP works** on what is **called a three way handshake** 
Three way handshake works like this :
- We gonna **send out a SYN packet**
- We are going to **receice a SYN/ACK packet** 
- We are going to **send an ACK packet**

For example: 
- When we go say **Hello** to a neighbor that is a **SYN packet** 
- **SYN/ACK is the response** *Ã©Hi syn, I acknowledge you"* 
- That's when the neighbor waving **Hello back** and then **you are good to go  and start a conversation** so that is the acknowledgment.

Now **we talk about this in terms of ports**, now **ports is an item that that could be opened on a  computer**, **it'a way to communicate with certain protocols**, for example when we talk about HTTP it's over port 80, if we talk about HTTPS it's over port 443.
There a lot of different protocols and **there are 65,535 ports**
Let's say we want to connect to a 443 port in a website.
- We are going to **send out a SYN Packet** to that website, *"Hey, I want to connect to you on port 443"*

*If 443 is open and available for connection they gonna say*
- He will **send us SYN/ACK packet** , *"Hey, go ahead and connect me"*
- And when **we will want to establish that connection we are going to send that acknowledgment packet back**.

#### Common Ports & Protocols	

| TCP | UDP | 
| --------- | -------- | 
| FTP (21) | DNS (53) |
| SSH (22) | DHCP (67, 68) |
| Telnet (23) | TFTP (69) |
| SMTP (25) | SNMP (161) |
| DNS (53) |
| HTTP (80) / HTTPS (443) |
| POP3 (110) |
| SMB (139 + 445) |
| IMAP (143) |

#### The OSI Model
<u>**The Mnemonic Sentence :** </u>

**P**lease **D**o **N**ot **T**hrow **S**ausage **P**izza **A**way


| Number | Layer | Examples|
| --------- | -------- |-------- |  
| 1 | **P**hysical Layer | Data cables, Ethernet |
| 2 | **D**ata | Switching  MAC Adresses |
| 3 | **N**etwork | IP Adresses, Routing |
| 4 | **T**ransport | TCP/UDP |
| 5 | **S**ession | Session managment |
| 6 | **P**resentation | WMV, JPEG, MOV |
| 7 | **A**pplication | HTTP, SMTP, FTP |

#### Subnetting
Subnets look like this : **255.255.255.0**
Subnets are all bits, just like an IP adress every period has 8 bits and we have 1 and 0
- If **all the 1 are on** we will have **255** 
- If **none the 1 are switched on** we will have **0**

<a href="https://docs.google.com/spreadsheets/d/1KDsT8szu5dNGy20Hp4ew689oG02NZFIU7MtTbngI36Q/edit?usp=sharing">
	<img src="https://i.ibb.co/mRS8sxJ/Screenshot-2020-12-26-08-20-33.png" alt="CheatSheet Subnet" border="0">
</a>

<u>**Example :**</u>

| IP | Subnet |
| --------- | -------- |
| 10.0.0.0/24 | 255.255.255.0 |
| 10.0.4.0/16 | 255.255.0.0 |
| 10.27.4.0/8 | 255.0.0.0 |
| 15.27.4.0/1 | 0.0.0.0 |

- Everytime We have **255 this number is locked in place**
- When we have **0 that number is between 0 and 255**

<u>**How to Know available Hosts in a network ?**</u>

| IP | Subnet | Empty bits | Empty Hosts |
| --------- | -------- |-------- | -------- |
| 10.17.4.0 | 255.0.0.0 | 32-16 = 24 | (2^24)-2 |

<u>**Understand the broadcast and the network**</u>

| IP | Subnet | Usable Hosts | Network | Broadcast |		
| --------- | -------- | --------- | -------- | -------- |
| 192.168.1.0/24 | 255.255.255.0 | 254| 192.168.1.0 | 192.168.1.255 |
| 192.168.1.0/28 | 255.255.240.0 | 14| 192.168.1.0 | 192.168.1.15 |
| 192.168.0.0/23 | 255.255.254.0 | 510 | 192.168.0.0 | 192.168.1.255 |
| 192.168.0.0/22 | 255.255.252.0 | 1022 | 192.168.0.0 | 192.168.3.255 |
| 192.168.1.0/26 | 255.255.255.192 | 62 | 192.168.1.0 | 192.168.1.63 |
| 192.168.1.0/27 | 255.255.255.224 | 30 | 192.168.1.0 | 192.168.1.31 |
- We always have to **substract 2 from the total ammount of hosts** because we have to substract the broadcast and the network and it will give us **the usable space**
- **The hosts double** each **increment of a CIDR**

### Introduction to Linux
#### Navigating the Filesystem
updatedb - updates database of information w/update passwd - changes password man - instructions for any command that you are using. ex. 'man ls'

| Command | Overview |
| -------- |-------- |  
| **pwd** |  Printworking directory cd  |
| **cd** | Change directory |
| **ls -la** | Lists everything in the folder |
| **mkdir** | Make directory |
| **rmdir** | Delete directory |
| **cp** | cp a file or a folder |
| **mv** | Move a file or a directory |
| **locate** | finds everything with a keyword |
| **man** | instructions for any command that you are using. ex. 'man ls' |

#### Users & Privileges

<u>**Linux Permission**</u>

<img src="https://opensource.com/sites/default/files/uploads/linuxpermissions_8.jpg" width="450" height="300" alt="CheatSheet Linux Permissions" border="0">
 
 

We can change permissions using the **Chmod** command
 for example ```chmod +rwx file.sh```
 But we can do it in a better way 
 ```chmod 777 file.sh```  
 
- **Write has 4 bits**
- **Read has 2 bits**
- **Execute has 1 bit**

We can add a user using **adduser 'name'** command

**/etc/passwd** - file that shows you **all the users**, everyone has **access**
**/etc/shadow** - file that shows you **all the passwords hashes**, only the **sudoers**
	
We can **change the user** using **su 'user'**

#### Common Network Commands

| Command | Overview |
| -------- |-------- |  
| **ip a** |  shows network information  |
| **iwconfig** |  show wirelsess network information |
| **ping** | it will sends packets and it's endless |
| **arp -a** | shows ip address it talks to and its mac address associated |
| **netstat -ano** | shows active connections running on your machine |
| **route** | prints your routing table, tells you where your traffic is exiting |

#### Viewing , Creating and Editing Files

| Command | Overview | Example |
| -------- |-------- | -------- |  
| **echo** |  can be used to write to a file  | ```echo "hey" > hey.txt``` |
| **cat** |  print content of a file | ```cat hello.txt``` |
| **touch** |  create empty file | ```touch hello.txt``` |
| **nano** | a terminal text editor | ```nano newfile.txt``` |

#### Starting & Stopping Kali Services

A Service can be a webserver, SSH or a SQL Database

We can start a service using the following command **service 'name' start** 
example :
```service apache2 start```

We can also start a local webserver using python 
```python -m SimpleHTTPServer 4444```
```python3 -m http.server 4444```

When we reboot the machine the service that we started will be stopped , if the session is gone , the service is gone.

We can permantly start a service using **systemctl enable 'name'**
```systemctl enable ssh```

#### Installing and Updating Tools

We can update and upgrade our sytem usign the following command :
- ```apt update && apt upgrade```

#### Scripting with Bash

**Commands That Will Be Used**

| Command | Overview |
| -------- |-------- |  
| **grep** |  allows us to narrow results  |
| **cut** |  allow us to to narrow results |
| **tr** | allow us to narrow results |
| **arp -a** | shows ip address it talks to and its mac address associated |
| **netstat -ano** | shows active connections running on your machine |
| **route** | prints your routing table, tells you where your traffic is exiting |

**Script Hard Coded**

```
#!/bin/bash
for ip in `seq 1 254`; do
ping -c 1 $1.$ip | grep "64 bytes" | cut -d " " -f 4 | tr -d ":" &
done
```
 
 **Fancy Script**
```
#!/bin/bash
if [ '$1' == '']
	then
	echo "You forgot an IP address"
	echo "Syntax; ./ipsweep.sh 192.168.1"
else
	for ip in `seq 1 254`; do
	ping -c 1 $1.$ip | grep "64 bytes" | cut -d " " -f 4 | tr -d ":" &
done
fi
```

**One Liner**
```
# for ip ($cat ip.txt); do nmap -sS -p 80 -T4 $ip & done
```

For ip's in the list we will loop. when we loop we will nmap stealth scan port 80, T4 (speed), $declare ip, & to let it run multiples.

### Introduction to Python
#### Basics
The **first thing** we have **to do** when we **create a Python file** is putting a **shebang** ```#!``` 
```
#!/bin/python3
```
This allows us **to show to the terminal where run the script** for example  :
```
# ./first.py
```
When we will run this, **the terminal will know that we have to run it using /bin/python3**

So we have **2 ways to run it**
```
# python3 first.py
# ./first.py
```

The **shebang isn't necessary** but it's better to do it 

We can **comment** using the following tag ```#```
``` 
# My comment
```

We can also **print a string** using the following commands
```
print("Hello, world!") # Double quote
print('Hello, world!') # Single quote
print("""This string runs
multiple line""") # Triple quote for multi-line
print ("This string is"+" awesome!") # We can concatenate

```

We can **line break** using the following command
```
print('\n') # New Line
```

#### Math
 The **nice think** about **Python** is that they have a built in **math interpreter**
 
 We can do some operation for example 
 ```
print(50 + 50) # add
print(50 - 50) # subtract
print(50 + 50) # multiply
print(50 / 50) # divide
print(50 + 50 - 50 * 50 / 50) # PEMDAS
print(50** 2) # exponents
print(50 % 6) # modulo
print(50 / 6) # leftovers
print(50 // 6) # no leftovers
```
We have **different ways** that we can multiply this numbers like the **math module** and some additional math items like bringing random numbers ...

#### Variables & Methods
**A variable is like a placeholder**, instead of typing a sentence we can just call a variable, it will **store the sentence in the variable and when we need we can call it**

```
quote = "All is faire in love and war."
print(quote)
```

A **method** is like a **function** that are availabe for a given object
```
quote = "All is faire in love and war."
print(quote.upper()) # method for making quote upperrcase
print(quote.lower()) # method for making quote lowercase
print(quote.title()) # method for making quote title case
print(len(quote)) # gives us all characters (length)
```

Make sure when using **integer**, that **it doesn't round** 
```
print(int(30.9)) // The output wil be 30 and not 31
print(float(30.9)) // The output will be 30.9 because it's a float
```

**We cannot concatenate a string with an integer** the fix is below
```
print("My name is " + name + " and I am " + age + "years old.") # Type Error

print("My name is " + name + " and I am " + str(age) + "years old.") #fix by str(age)
```

It doesn't matter how you store it you can do += or -= to incorporate math into variables
```
age = 30
age += 1 # adding a year to our age 
print(age) # 31
```

```
birthday = 1 
age += birthday #adding variable "birthday" to 'age" print(age)
```

#### Functions
**Function are like many programs** it's like this **organized block of code that you define and call it later**, and it's make more simple then write everything 

```
def who_am_i() : # this is an example function
	name = "Iliass"
	age = 14
	print("My name is "+ name + "and I am " + str(age) + " years old")
who_am_i() # I call the function
```
We can have a **function with parameters !**
```
def add_one_hundred(num) :
	print(num + 100)
add_one_hundred(100)
```
We an also have a **function with multi parameters** 
```
def add(x,y):
	print(x + y)
add(7, 7)
```
**Instead of printing the parameter** we can **return** like in the above example
```
def multipy(x, y):
	return x * y
print(multipy(7,7))
```
**Instead of printing a new line** we can **define a function**
```
def nl():
	print("\n")
nl()
```

#### Boolean Expressions
When we say **boolean expressions** we can just think of **true or false**

There is a **difference between True & "True"** one is a **boolean** and one is a **string** 
for example if we set **bool5 to "True"** it will be a **string**
```
bool5 = 'True'
print(type(bool5)) # <class 'str'>
```
but if we set **bool1 to True** it will be a **bool**
```
bool1 = True
print(type(bool1)) # <class 'bool'>
```

#### Relational Operators & Boolean Operators

In this example we are using an **operator** with the **greater than operator** and we are also using a **boolean expression** because when we say **seven is greater than five**, that is going to be **True**
```
greater_than = 7 > 5 # Ture
```
Let's take another example, when used the operator **And** we in **order to be true the both has to be true** but **if one of them is false the whole thing will be false**
```
test_and = (7 > 5) and (5 < 7) # True 
test_and = (7 > 5) and (5 > 7) # False
```
But in the case of the **Or** Operator if one of them becomes false the **whole thing will be True** in case **to be false** they **both has to be false**
```
test_or = ( 7 > 5) or (5 < 7) # True
test_or2 = ( 7 > 5 ) or ( 5 > 7) # True 
```

**Truth Table**

| AND | True | False |
| -------- |--------|-------- |
| **True** | *True* | *False* |
| **False** | *False* | *False* |

| OR | True | False |
| -------- |--------|-------- |
| **True** | *True* | *True* |
| **False** | *True* | *False* |
Where python is important when comming to pentesting **is not necesserily being able to develop**, it is **beeing able to read and understand** what is going on is super important

#### Conditional Statements
We can **think conditional statements** as an If else **scenario**, for example if **I go to a shop and buy a drink**, and **i have 2** you are going to be **able to buy it** but if **I had 1$ I couldn't buy it**, that is a **condition based on the amount of money.** 
We can run **if** **else** or **elseif** and build upon this
**Conditional statement** is going to start **looking like a function** 
```
def drink(money):	
	if money >= 2:
		return "You've got yourself a drink!"
	else:
		return "No drink for you!"
print(drink(3))
print(drink(1))
```
Let's try to do **a muliply conditions** in the following example, we are going to introduce someting new called **elif**
```
def alcohol(age, money):
	if (age >= 21) and (money >= 5):
		return "We're getting a drink!"
	elif (age >= 21) and (money < 5):
		return "Come back with more money."
	elif (age < 21) and (money >= 5):
		return "Nice try, kid!"
	else:
		return "You're too poor and too young"
print(alcohol(21,5))
print(alcohol(21,4))
print(alcohol(20,4))
```

#### Lists
**Lists are data structures** and these data structures are changeable, **we can re-order them** and put them in list.
when **we have a list** everything **inside is called an item** the best way to think of **a list is to think that it live between brackets** there are other things that **looks like a list** but **it's not a realy a list** because of how **it's defined** and how we're going to define lists is because **they live in brackets just like a string**
When we talk about items we talk about numerical order, the 0 is 1, the 1 is 2 ...

```
movies = ["Avengers Endgame", "Back to the future", "Fast & Furious", "Start Wars"]

print(movies[1])#returns 2nd item in the list 
print(movies[0]) #returns first item in the list
print(movies[0:4])#prints all items in the list 
print(movies[1:]) #Grabs all items in the list after one.
print(movies[:1])#Grabs all items in the list before 1 
print(movies[-1])#Grabs the last items on the Lists

print(len(movies))#counts the items in the Lists 
movies.append("JAWS") #adds item to the end of the List  
movies.pop()#deletes the last items on the List 
movies.pop(0)#deletes the first items in the List
```

#### Tuples
**Tuples** are **like lists but not exacly like lists**, **lists are what we call mutable**, meaning that **they can be changed**, **Tuples** are **immutable**, they **can't be changed.**
Tuples has **parentheses instead of brackets**
```
grades = ("a", "b", "c", "d")
print(grades[1])
```

#### Looping
We already saw Looping in the in bash scripting but now we gonna saw it also in Python.
As long as we have something to iterate through it will print until the iteration finishs
```
vegetables = ["cucumber", "spinach", "cabbage"]
for x in vegetables:
	print(x)
```
A while loop executes as long as true 
```
i = 1
while i < 10:
	print(i)
	i += 1 
```

#### Importing Modules
**Importing** is **important** because **modules are exsiting in python and we have a lot of that are built in**, but there are **modules** that are **not built in but available to us**. 
For example a module called sys that modules that a lot of important this that has to deal with anything  related to sytem functions and parametres.
**We have to import sys because it does not by default** come imported but some **items are already built in by default but sys is not**
```
import sys

print(sys.version)
```
We can also **import a specific part of a module** forexample
```
from datetime import datetime

print(datetime.now())
```
We can also **import with aliases**
```
from datetime import datetime as dt

print(dt.now())
```

#### Advanced Strings
**Everthing we can do an array we can also do it on a string** forexample **pull the first letter** ...
```
my_name = "Iliass"
print(my_name[0]) # it will show us the fist Letter
print(my_name[-1]) # it will show us the last letter

sentence = "This is a sentence."
print(sentence[:4]) # it will show us the first word
print(sentence[-9]) # it will show us the last word

sentence_split = sentence.split()
print(sentence_split) # it will sill split the sentence based on a delimiter
# OUTPUT : ['This', 'is', 'a', 'sentence.']

sentence_join = ' '.join(sentence_split)
print(sentence_join) # it will do the reverse of the split module
```

**We can't put quotes inside a string** it wil throw us an error **we could some character escaping**, we can udelise a **back slash**, it will say threat is as a string  don't threat as a quotation
```
quote = "He said, \"give me all your money\""
print(quote)
```

At first **we was concatenating we was doing something like this**
```
movie = "The Hangover"
print("My favorite movie is " + movie)
```
but **we could do something more advanced using a placeholder** like this
```
movie = "The Hangover"
print("My favorite movie is {}".format(movie))
```
but it's difficult **we could make it more simple**
```
movie = "The Hangover"
print(f"My favorite movie is {movie}")
```
 
#### Dictionnaries
**Dictionnaries are like key values pairs**. Let's say we have a dictionnary and we want to have a menu, in this example **the drink is the key and the price is the value**.
```
drink = {"Coca Cola": 2, "Hawai": 4, "Sprite": 3}
print(drink)
```
We can have **multiple keys on a value**
```
employees = {"Finance" : ["Bob", "Linda", "Tina"], "IT": ["Gene", "Louise", "Teedy"], "HR": ["Jimmy Jr.", "Mort"]}
print(employees)
```
We can **add a new Key/Value Pair**
```
employees["legal"] = ["Mr.Frond"]
print(employees)
#or
employees.update({"sales": ["andie", "ollie"]})
print(employees)
```
We can also **update**
```
drink["Coca Cola"] = 5
print(drink) #updates price of Coca Cola
print(drink.get("Coca Cola")) #pulls from a dictionary
```

#### Sockets
**This Module is very important** because **we gonna use sockets to connect to nodes together** and also to **connect to an open port and IP adress**. 
```
import socket
HOST = '127.0.0.1'
PORT = 4444

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#AF_INET = ipv4
#sock_stream = port

s.connect((HOST,PORT))
```
When we used **AF_INET that just means IpV4** and when we used **sock_stream that just meant port**
then after we can just **launch netcat and listen on the port.**

### The Ethical Hacker Methodology

#### The Five Stages of Ethical Hacking
These are the five stages that we will go through on every assessment.

- Reconnaissance (Information Gathering)
- Scanning and Enumeration (Nmap, Nessus, Nikto, Etc) 
- Gaining Access (Exploitation)  
- Maintaining Access (Backdoor)
- Covering Tracks (Delete Logs ...)

### Information Gathering (Reconnaissance)
#### Passive Reconnaissance Overview
- Physical / Social 
	- Location Information 
		- Satellite images
		- Drone recon
		- Building layout (badge readers, security)
	- Job information 
		- Employees (name, job title, phone number)
		- Pictures (badge photos, desk photos)

- Web / Host
	- Target Validation (WHOIS, nslookup, dnsrecon)
	- Finding Subdomains (Google Fu, dig, Nmap, Sublist3r, Bluto, crt.sh)
	- Fingerprinting (Nmap, Wappalyzer, Netcat)
	- Data Breaches (HaveIbeenPwned, BreachParse, WeLeakInfo)

The **better scanning and enumeration** that you can do the **better hacker** you are going to be.

#### Identify Our Target
**Before we begin our reconnaissance we have to establish a client to attack.**
We are going to be utilizing a client out of bugcrowd. **Bugcrowd.com is a bugbounty website that can be used to practice and also make a bit of cash.**
When we are doing, **we have to make sure to stay in scope.**

#### Email Adress Gathering with Hunter.io
**When we first start we have to look into items on websites regarding to users email format and breach credentials.**

**Hunter.io is a domain search** it give us a **list of people in this organisation** for example **first name**,  **last name** and also **email adresses**, we these **email adress we can password spay them** we take the list of email and try a password with them and hope to get a hit.

#### Gathering Breached Credentials with Breach-Parse
There is **a tool named Breach-Parse** that use **a big combolist \[44GB\]** and **we can look in it to find an email adress and a password**

#### Using Theharvester 
This **tool is built in Kali Linux**, and it **will search in google and try to find some emails** but **also Hosts and subdomains** and there are better tools to find more informations

#### Hunting subdomains
This **going to be important** because **a lot of time we're going to be tasked with a web penetration test** and being able to gather information and perform enumeration on those Web sites is super important.
**The first thing we have to do is to identify what subdomains are out there** because we might run into something that is like dev.tesla.com or also a website like test.tesla.com because if you just look at test.com you're limiting yourself into one website and they could be potontially a ton of websites.

Theres is an important **tool called sublist3r** and it **will look into a ton of websites to find a subdomain**
There is also **another website called crt.sh and he will look out for certificated** registred and it named **certificate fingerprinting** and because of that we can also **find subdomains**
Sublist3r can also find fourth levels for you and it's very useful, and this will help us to look up what there are doing in the backend.
But there is **a powerful tool named OWASP Amass** and this tool **has a lot of things** like sublist3r and crt.sh
Sometime those **subdomains can't work** we can also use **a tool named tomnomnom/httprobe and he will look if these sub domains are working or not**

#### Identifying Website Technologies
There is **a website named BuitWith.com**, it will help us to **find the technologie built with**, but there a **better way named Wappalyzer** it's an extension that will look for the technologies used.
There is another **in the terminal named whatweb** and it will look out for the technology and IP adress used

#### Information Gathering with Burp Suite 
**Burp suite** is a what we **call a web proxy**, that means that it has **the capability of intercepting traffic for us**, it's intercepting **request that this website is making out**.

#### Google Fu
**Google has search operators** and it will **help us to find some useful informations.** like **subdomains or filter using a filetype**
 
 #### Utilizing Social Medias
 We could **look into** a website like **linkedin or twitter** and **find useful informations** we can find a **badge**, a **picture of employees**
 **People are always the weekest point in any company**